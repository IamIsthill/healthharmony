{% extends 'base.html' %}
{% load cache %}
{% load static %}
{% load tags %}

{% block header %}
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <style>
    img {
      width: 500px;
      height: 500px;
    }

    .hide {
      display: none;
    }
  </style>
{% endblock %}

{% block title %}
  Patient Information | HealthHarmony
{% endblock %}

{% block message %}
  {% if messages %}
    <div>
      {% for m in messages %}
        <p>{{ m }}</p>
      {% endfor %}
    </div>
  {% endif %}
{% endblock %}
{% block main %}
  <div class="spinner-border" role="status" id="loading-spinner">
    <span class="visually-hidden text-success">Loading...</span>
  </div>

  <div class="container">
    {% include 'patient/nav.html' %}
    <hr />
    <div>
      <h2>Patient Profile</h2>
      {% if user.profile != 'user_profiles/fallback.png' %}
        <img src="{{ user.profile.url }}" alt="user_uploaded" />
      {% elif picture.picture is not None %}
        <img src="{{ picture.picture }}" alt="google_pic" />
      {% else %}
        <img src="{{ user.profile.url }}" alt="fallback" />
      {% endif %}

      <form action="" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <label for="">Profile:</label>
        <input type="file" name="profile" id="profile-picture" accept=".png, .jpeg, .jpg" />
        <label for="">First Name:</label>
        <input type="text" value="{% if user.first_name is not None %}{{ user.first_name }}{% endif %}" name="first_name" />
        <label for="">Last Name:</label>
        <input type="text" value="{% if user.last_name is not None %}{{ user.last_name }}{% endif %}" name="last_name" />
        <label for="">Year:</label>
        <input type="number" value="{{ user.year }}" name="year" />
        <label for="">Section:</label>
        <input type="number" value="{{ user.section }}" name="section" />
        <label for="">Program:</label>
        <input type="text" value="{% if user.program is not None %}{{ user.program }}{% endif %}" name="program" />
        <label for="">Department:</label>
        <input type="text" value="{% if user.department is not None %}{{ user.department }}{% endif %}" name="department" />
        <br />
        <label for="sex">Sex:</label>

        <select name="sex" id="sex">
          <option value="Male">Male</option>
          <option value="Female">Female</option>
        </select>
        <label for="">Date of Birth:</label>
        <input type="date" name="DOB" value="{{ user.DOB|date:'Y-m-d' }}" />
        <label for="">Contct Number:</label>
        <input type="number" value="{{ user.contact }}" name="contact" />
        <button type="submit">Update</button>
      </form>
    </div>
    <hr />
    <div>
      <div>
        <h3>Detailed Information</h3>
        {% if age %}
          <p>Age:{{ age }}</p>
        {% endif %}
        {% if user.sex is not None %}
          <p>Sex:{{ user.sex }}</p>
        {% endif %}
        {% if user.contact is not None %}
          <p>Contact:{{ user.contact }}</p>
        {% endif %}
        {% if user.year and user.section is not None %}
          <p>Year and Section: {{ user.year }} - {{ user.section }}</p>
        {% elif user.year is not None %}
          <p>Year:{{ user.year }}</p>
        {% elif user.section %}
          <p>Section:{{ user.section }}</p>
        {% endif %}
        {% if user.program is not None %}
          <p>Program: {{ user.program }}</p>
        {% endif %}
        {% if user.department is not None %}
          <p>Department: {{ user.department }}</p>
        {% endif %}
      </div>
      <div>
        <h3>Vital Statistics</h3>
        {% if user.blood_type is not None %}
          <p>Blood Type: {{ user.blood_type }}</p>
        {% endif %}
        {% if blood_pressure %}
          <p>Blood Pressure:{{ blood_pressure }}</p>
        {% endif %}
        {% if user.height is not None %}
          <p>Height: {{ user.height }}</p>
        {% endif %}
        {% if user.weight is not None %}
          <p>Weight: {{ user.weight }}</p>
        {% endif %}
      </div>
    </div>
  </div>
  <div id="profileModal" class="hide">
    <div>Invalid file type. Please upload a PNG, JPEG, or JPG file.</div>
    <button class="close">Ok</button>
  </div>
{% endblock %}
{% block script %}
  {{ request.user.id|json_script:'userId' }}
  <script type="module">
    import { setSpinner } from '/static/js/spinner.js'

    main()

    async function main() {
      const userId = JSON.parse(document.getElementById('userId').textContent)
      const mainContainer = document.querySelector('.container')
      const spinner = document.getElementById('loading-spinner')
      const pageUrl = `/patient/patient-profile/${userId}/`

      setSpinner(mainContainer, spinner, pageUrl)
    }
  </script>
{% endblock %}
