{% extends 'base.html' %}
{% load cache %}
{% load static %}
{% load tags %}

{% block header %}
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <style>
    img {
      width: 500px;
      height: 500px;
    }
  </style>
{% endblock %}

{% block title %}
  Patient Information | HealthHarmony
{% endblock %}

{% block message %}
  {% if messages %}
    <div>
      {% for m in messages %}
        <p>{{ m }}</p>
      {% endfor %}
    </div>
  {% endif %}
{% endblock %}
{% block main %}
  <div class="spinner-border" role="status" id="loading-spinner">
    <span class="visually-hidden text-success">Loading...</span>
  </div>

  <div class="container">
    {% include 'patient/nav.html' %}
    <hr />
    <div>
      <h2>Patient Profile</h2>
      <img src="{{ user.profile.url }}" alt="" />
      <form action="" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <label for="">Profile:</label>
        <input type="file" name="profile" />
        <label for="">First Name:</label>
        <input type="text" value=" {{ user.first_name }}" name="first_name" />
        <label for="">Last Name:</label>
        <input type="text" value=" {{ user.last_name }}" name="last_name" />
        <label for="">Year:</label>
        <input type="number" value="{{ user.year }}" name="year" />
        <label for="">Section:</label>
        <input type="number" value="{{ user.section }}" name="section" />
        <label for="">Program:</label>
        <input type="text" value="{{ user.program }}" name="program" />
        <label for="">Department:</label>
        <input type="text" value="{{ user.department }}" name="department" />
        <br />
        <label for="sex">Sex:</label>

        <select name="sex" id="sex">
          <option value="Male">Male</option>
          <option value="Female">Female</option>
        </select>
        <label for="">Date of Birth:</label>
        <input type="date" name="DOB" value="{{ user.DOB|date:'Y-m-d' }}" />
        <label for="">Contct Number:</label>
        <input type="number" value="{{ user.contact }}" name="contact" />
        <button type="submit">Update</button>
      </form>
    </div>
    <hr />
    <div>
      <div>
        <h3>Detailed Information</h3>
        <p>Age:</p>
        <p>
          Sex:{% if user.sex is not None %}
            {{ user.sex }}
          {% endif %}
        </p>
        <p>
          Contact Number:{% if user.contact is not None %}
            {{ user.contact }}
          {% endif %}
        </p>
        <p>
          Year and Section:{% if user.year and user.section is not None %}
            {{ user.year }} - {{ user.section }}
          {% elif user.year is not None %}
            {{ user.year }}
          {% elif user.section is not None %}
            {{ user.section }}
          {% endif %}
        </p>
        <p>Program: {{ user.program }}</p>
        <p>Department: {{ user.department }}</p>
      </div>
      <div>
        <h3>Vital Statistics</h3>
        <p>Blood Type: {{ user.blood_type }}</p>
        <p>Height: {{ user.height }}</p>
        <p>Weight: {{ user.weight }}</p>
      </div>
    </div>
  </div>
{% endblock %}
{% block script %}
  {{ request.user.id|json_script:'userId' }}
  <script type="module">
    import { setSpinner } from '/static/js/spinner.js'
    
    main()
    
    async function main() {
      const userId = JSON.parse(document.getElementById('userId').textContent)
      const mainContainer = document.querySelector('.container')
      const spinner = document.getElementById('loading-spinner')
      const pageUrl = `/patient/patient-profile/${userId}/`
    
      setSpinner(mainContainer, spinner, pageUrl)
    }
  </script>
{% endblock %}
